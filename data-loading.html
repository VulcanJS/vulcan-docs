<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Data Loading | Vulcan Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.ico" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://docs.vulcanjs.org">
    <meta property="og:title" content="Data Loading | Vulcan Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@telescopeapp">
    <meta name="twitter:title" content="Data Loading | Vulcan Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />


  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      <a class="logo-wrapper" href="http://docs.vulcanjs.org/" title="Vulcan Documentation Vulcan Documentation"  >
        <img src="/images/vulcan-logo-border-2.svg" alt="Vulcan Documentation" class="logo"/>
        <span>Vulcan Documentation</span>
      </a>
    </div>
  </div>

  <div class="nav-group right">

    <div class="nav-item wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search Vulcan Docs" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://docs.vulcanjs.org/" title="Vulcan Documentation"  >
        <span>Vulcan Documentation Vulcan Documentation</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://slack.telescopeapp.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      
    </div>

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Overview</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="features.html" class="sidebar-link ">
                  <span>Features</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="architecture.html" class="sidebar-link ">
                  <span>Architecture</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="vulcan.html" class="sidebar-link ">
                  <span>From Telescope to Vulcan</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="packages.html" class="sidebar-link ">
                  <span>Packages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="common-problems.html" class="sidebar-link ">
                  <span>Common Problems</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Data Layer</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="schemas.html" class="sidebar-link ">
                  <span>Collections & Schemas</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Data Loading</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="terms-parameters.html" class="sidebar-link ">
                  <span>Terms & Parameters</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="redux.html" class="sidebar-link ">
                  <span>Using Redux</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="theming.html" class="sidebar-link ">
                  <span>Components & Theming</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="core-components.html" class="sidebar-link ">
                  <span>Core Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="callbacks.html" class="sidebar-link ">
                  <span>Callbacks</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="users.html" class="sidebar-link ">
                  <span>Users</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="groups-permissions.html" class="sidebar-link ">
                  <span>Groups & Permissions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="internationalization.html" class="sidebar-link ">
                  <span>Internationalization</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="head-tags.html" class="sidebar-link ">
                  <span>Head Tags</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="settings.html" class="sidebar-link ">
                  <span>Settings</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Forms</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="forms.html" class="sidebar-link ">
                  <span>Forms</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-custom.html" class="sidebar-link ">
                  <span>Custom Form Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-upload.html" class="sidebar-link ">
                  <span>Upload Package</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Packages</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="email.html" class="sidebar-link ">
                  <span>Email</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="newsletter.html" class="sidebar-link ">
                  <span>Newsletter</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="payments.html" class="sidebar-link ">
                  <span>Payments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="admin.html" class="sidebar-link ">
                  <span>Admin Dashboard</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="embed.html" class="sidebar-link ">
                  <span>Embed</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cloudinary.html" class="sidebar-link ">
                  <span>Cloudinary</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="voting.html" class="sidebar-link ">
                  <span>Voting</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Tutorials</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="example-simple.html" class="sidebar-link ">
                  <span>Simple Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-movies.html" class="sidebar-link ">
                  <span>Movies Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-instagram.html" class="sidebar-link ">
                  <span>Instagram Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-forum.html" class="sidebar-link ">
                  <span>Forum Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-customization.html" class="sidebar-link ">
                  <span>Customization Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-permissions.html" class="sidebar-link ">
                  <span>Permissions Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="sponsorship-tutorial.html" class="sidebar-link ">
                  <span>Sponsorship Flow Tutorial</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migration Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="recipes.html" class="sidebar-link ">
                  <span>Recipes</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Resources</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="learn.html" class="sidebar-link ">
                  <span>Learn More</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="examples.html" class="sidebar-link ">
                  <span>Examples</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="plugins.html" class="sidebar-link ">
                  <span>Plugins</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="themes.html" class="sidebar-link ">
                  <span>Themes</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorials.html" class="sidebar-link ">
                  <span>Tutorials</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="videos.html" class="sidebar-link ">
                  <span>Videos</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Data Loading</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/vulcanjs/vulcan-docs/tree/master/source/data-loading.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <h2 id="Data-Flow"><a href="#Data-Flow" class="headerlink" title="Data Flow"></a>Data Flow</h2><p>When you connect to a GraphQL-powered site, the client makes an API request to load the data it needs. </p>
<p>Unlike traditional REST APIs, the client doesn’t just hit an API endpoint but actually sends a list of <em>what data it needs</em> to the server. The specific document properties needed by the client are defined in a <strong>fragment</strong>. </p>
<p>Upon receiving that query, the server validates the fragment against the main GraphQL <strong>schema</strong>.</p>
<p>If that validation passes, the server then looks for a <strong>query resolver</strong> that will specify how to actually retrieve the data (presumably through some kind of database <code>find()</code> operation).</p>
<p>Data mutations (inserting, editing, or removing a document) function in a similar way.</p>
<p>The client sends a query that includes the name of the mutation, the mutation arguments, as well as specifies what data the client expects back once the mutation is complete. </p>
<p>The server then looks for a <strong>mutation resolver</strong> and executes it.</p>
<h2 id="Document-Resolvers"><a href="#Document-Resolvers" class="headerlink" title="Document Resolvers"></a>Document Resolvers</h2><p>You can pass a <code>resolver</code> object to <code>createCollection</code>. It should include three <code>list</code>, <code>single</code>, and <code>total</code> resolvers.</p>
<p>Each resolver should have the following properties:</p>
<ul>
<li><code>name</code>: the resolver’s name.</li>
<li><code>resolver</code>: the resolver function.</li>
</ul>
<p>Note that if your collections include private data, you’ll have to implement your own security layer inside each resolver to prevent unwanted access. Check out the <a href="/groups-permissions.html#Controlling-Viewing">Controlling Viewing</a> section for more details. </p>
<h3 id="List-Resolver"><a href="#List-Resolver" class="headerlink" title="List Resolver"></a>List Resolver</h3><p>The <code>list</code> resolver is used to display lists of documents. It takes the following arguments:</p>
<ul>
<li><code>terms</code>: a JSON object containing a list of terms used to filter and sort the list.</li>
<li><code>offset</code>: how many documents to offset the list by (used for paginating requests).</li>
<li><code>limit</code>: how many documents to return.</li>
</ul>
<p>It should return an array of documents.</p>
<h3 id="Single-Resolver"><a href="#Single-Resolver" class="headerlink" title="Single Resolver"></a>Single Resolver</h3><p>The <code>single</code> resolver takes a <code>documentId</code> argument, and should return a single document.</p>
<h3 id="List-Total-Resolver"><a href="#List-Total-Resolver" class="headerlink" title="List Total Resolver"></a>List Total Resolver</h3><p>The <code>total</code> resolver takes a <code>terms</code> argument and should return the total count of results matching these terms in the database. </p>
<h3 id="Default-Resolvers"><a href="#Default-Resolvers" class="headerlink" title="Default Resolvers"></a>Default Resolvers</h3><p>Vulcan provides a set of default List, Single and Total resolvers you can use to save time:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createCollection, getDefaultResolvers, getDefaultMutations &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line"></span><br><span class="line">  collectionName: <span class="string">'Movies'</span>,</span><br><span class="line"></span><br><span class="line">  typeName: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line">  </span><br><span class="line">  resolvers: getDefaultResolvers(<span class="string">'Movies'</span>),</span><br><span class="line"></span><br><span class="line">  mutations: getDefaultMutations(<span class="string">'Movies'</span>), </span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>To learn more about what exactly the default resolvers do, you can <a href="https://github.com/VulcanJS/Vulcan/blob/devel/packages/vulcan-core/lib/modules/default_resolvers.js" target="_blank" rel="noopener">find their code here</a>.</p>
<h3 id="Custom-Queries"><a href="#Custom-Queries" class="headerlink" title="Custom Queries"></a>Custom Queries</h3><p>You can also use <code>GraphQLSchema.addQuery</code> to define your own root queries:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentUserResolver = &#123;</span><br><span class="line">  Query: &#123;</span><br><span class="line">    currentUser(root, args, context) &#123;</span><br><span class="line">      <span class="keyword">return</span> context.Users.findOne(&#123; <span class="attr">_id</span>: args.userId &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">GraphQLSchema.addResolvers(currentUserResolver);</span><br><span class="line"></span><br><span class="line">GraphQLSchema.addQuery(<span class="string">`currentUser: User`</span>);</span><br></pre></td></tr></table></figure>
<p>Learn more about resolvers in the <a href="http://dev.apollodata.com/tools/graphql-tools/resolvers.html" target="_blank" rel="noopener">Apollo documentation</a>.</p>
<h2 id="Field-Resolvers"><a href="#Field-Resolvers" class="headerlink" title="Field Resolvers"></a>Field Resolvers</h2><p>Although Vulcan uses your SimpleSchema JSON schema to generate your GraphQL schema, it’s important to understand that the two can be different. </p>
<p>For example, you might have a <code>userId</code> property in your <code>Movie</code> schema, but want this property to <em>resolve</em> as a <code>user</code> object in your GraphQL schema (and in turn, in your client store). You can use <code>resolveAs</code> to accomplish this:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userId:</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">String,</span></span><br><span class="line"><span class="attr">  optional:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="attr">  viewableBy:</span> <span class="string">['guests'],</span></span><br><span class="line"><span class="attr">  resolveAs:</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    fieldName:</span> <span class="string">'user'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    arguments:</span> <span class="string">'foo: Int = 10'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">'User'</span><span class="string">,</span></span><br><span class="line"><span class="attr">    resolver:</span> <span class="string">(movie,</span> <span class="string">args,</span> <span class="string">context)</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></span><br><span class="line">      <span class="string">return</span> <span class="string">context.Users.findOne(&#123;</span> <span class="attr">_id:</span> <span class="string">movie.userId</span> <span class="string">&#125;,</span> <span class="string">&#123;</span> <span class="attr">fields:</span> <span class="string">context.Users.getViewableFields(context.currentUser,</span> <span class="string">context.Users)</span> <span class="string">&#125;);</span></span><br><span class="line">    <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">    addOriginalField:</span> <span class="literal">true</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;,</span></span><br></pre></td></tr></table></figure>
<p>We are doing five things here:</p>
<ol>
<li>Specifying that the field should be named <code>user</code> in the API.</li>
<li>Specifying that the field can take a <code>foo</code> argument that defaults to <code>10</code>.</li>
<li>Specifying that the <code>user</code> field returns an object of GraphQL type <code>User</code>.</li>
<li>Defining a <code>resolver</code> function that indicates how to retrieve that object.</li>
<li>Specifying that the original field (<code>userId</code>, with type <code>String</code>) should also be added to our GraphQL schema. </li>
</ol>
<h3 id="Custom-Types"><a href="#Custom-Types" class="headerlink" title="Custom Types"></a>Custom Types</h3><p>Creating a collection with <code>createCollection</code> will automatically create the associated GraphQL type, but in some case you might want to resolve a field to a GraphQL type that doesn’t correspond to any existing collection. </p>
<p>Here’s how the <code>vulcan:voting</code> package defines a new <code>Vote</code> GraphQL type:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const voteSchema = `</span><br><span class="line"> <span class="built_in"> type </span>Vote &#123;</span><br><span class="line">    itemId: String</span><br><span class="line">    power: Float</span><br><span class="line">    votedAt: String</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  union Votable = Post | Comment</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">addGraphQLSchema(voteSchema);</span><br></pre></td></tr></table></figure>
<p>Which can then be used as the value for <code>type</code> in a <code>resolveAs</code> field. </p>
<h3 id="GraphQL-Only-Fields"><a href="#GraphQL-Only-Fields" class="headerlink" title="GraphQL-Only Fields"></a>GraphQL-Only Fields</h3><p>Note that a field doesn’t have to “physically” exist in your database to be able to generate a corresponding GraphQL field. </p>
<p>For example, you might want to query the Facebook API to get the number of likes associated with a post’s URL:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">likesNumber</span>: &#123;</span><br><span class="line">  <span class="attribute">type</span>: Number,</span><br><span class="line">  optional: true,</span><br><span class="line">  viewableBy: [<span class="string">'guests'</span>],</span><br><span class="line">  resolveAs: &#123;</span><br><span class="line">    fieldName: <span class="string">'likesNumber'</span>,</span><br><span class="line">    type: <span class="string">'Number'</span>,</span><br><span class="line">    resolver: async (post, args, context) =&gt; &#123;</span><br><span class="line">      return await <span class="built_in">getFacebookLikes</span>(post.url);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>This will create a <code>likesNumber</code> field in your GraphQL schema (and your Apollo store) even though no such field exist in your database. </p>
<h3 id="String-Syntax"><a href="#String-Syntax" class="headerlink" title="String Syntax"></a>String Syntax</h3><p>Alternatively, you can also use the legacy syntax and specify a string value for <code>resolveAs</code> (in this case, <code>user: User</code>). You’ll then need to use <code>addGraphQLResolvers</code> to define the resolver object yourself:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addGraphQLResolvers &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> movieResolver = &#123;</span><br><span class="line">  Movie: &#123;</span><br><span class="line">    user(movie, args, context) &#123;</span><br><span class="line">      <span class="keyword">return</span> context.Users.findOne(&#123; <span class="attr">_id</span>: movie.userId &#125;, &#123; <span class="attr">fields</span>: context.getViewableFields(context.currentUser, context.Users) &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">addGraphQLResolvers(movieResolver);</span><br></pre></td></tr></table></figure>
<p>Resolvers can be defined on any new or existing type (e.g. <code>Movie</code>).</p>
<h2 id="Caching-amp-Batching"><a href="#Caching-amp-Batching" class="headerlink" title="Caching &amp; Batching"></a>Caching &amp; Batching</h2><p>You can optionally use <a href="https://github.com/facebook/dataloader" target="_blank" rel="noopener">Dataloader</a> inside your resolvers to get server-side better performance through caching and batching.</p>
<p>To understand how this works, let’s suppose you’re displaying five posts on your homepage, each of which has an author. </p>
<p>Without batching, this would result in one database call to fetch the five posts, then one call per post to fetch the author as each <code>Post.author</code> resolver is called, for a total of six database queries. </p>
<p>With batching enabled, these five calls to the <code>users</code> collection are batched together, for a total of two database calls. </p>
<p>Additionally, with caching enabled, any queries for the same documents (for example, your posts also have <code>commenters</code>) won’t hit the database at all but instead load data from Dataloader’s cache. </p>
<p>Note that the cache is <strong>per-request</strong>, meaning that it will not persist across multiple reloads or different users (which would otherwise lead to outdated data).</p>
<p>To load data from Dataloader instead of the database, you can use the following two functions:</p>
<ul>
<li><code>collection.loader.load(_id)</code>: takes the <code>_id</code> of a document.</li>
<li><code>collection.loader.loadMany(_ids)</code>: takes an array of <code>_id</code>s. </li>
</ul>
<p>If the documents requested are not present in the cache, Dataloader will automatically query the database for them. </p>
<p>Aditionally, you can also manually add documents to the cache with:</p>
<ul>
<li><code>collection.loader.prime(_id, document)</code></li>
</ul>
<p>Finally, note that <code>load</code> and <code>loadMany</code> can only take <code>_id</code>s. If you instead need to query for data using more complex Mongo selectors, you can simply keep querying the database directly with <code>collection.find()</code> and <code>collection.findOne()</code>. </p>
<p>Learn more: <a href="https://www.youtube.com/watch?v=55Ep5KBTIQE" target="_blank" rel="noopener">Using Dataloader to batch and cache database calls
</a>.</p>
<h2 id="Higher-Order-Components"><a href="#Higher-Order-Components" class="headerlink" title="Higher-Order Components"></a>Higher-Order Components</h2><p>To make working with Apollo easier, Vulcan provides you with a set of higher-order components (HoC). </p>
<p>An HoC is simply a function you can call on a React component to give it additional props.</p>
<h3 id="withList"><a href="#withList" class="headerlink" title="withList"></a>withList</h3><p>The <code>withList</code> HoC is used to display lists of documents. It takes the following options:</p>
<ul>
<li><code>queryName</code>: an arbitrary name for the query.</li>
<li><code>collection</code>: the collection on which to look for the <code>list</code> resolver.</li>
<li><code>fragment</code> or <code>fragmentName</code>: the fragment to use. If you pass <code>fragmentName</code> instead of <code>fragment</code>, the name you passed will be used to look up a fragment registered with <code>registerFragment</code>. </li>
</ul>
<p>For example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listOptions = &#123;</span><br><span class="line">  collection: Movies,</span><br><span class="line">  queryName: <span class="string">'moviesListQuery'</span>,</span><br><span class="line">  fragment: MoviesItem.fragment,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withList(listOptions)(MoviesList);</span><br></pre></td></tr></table></figure>
<p>The resulting wrapped component also takes in the following options:</p>
<ul>
<li><code>terms</code>: an object containing a list of querying, sorting, and filtering terms.</li>
</ul>
<p>Note that <code>terms</code> needs to be passed not as an option, but as a prop from the <em>parent</em> component.</p>
<p>The HoC then passes on the following props:</p>
<ul>
<li><code>loading</code>: <code>true</code> while the data is loading.</li>
<li><code>results</code>: the loaded array of documents.</li>
<li><code>totalCount</code>: the total count of results.</li>
<li><code>count</code>: the number of current results (i.e. <code>results.length</code>).</li>
<li><code>refetch</code>: a function that can be called to trigger a query refetch.</li>
<li><code>loadMore</code>: a function that can be called to load more data. </li>
</ul>
<h3 id="withDocument"><a href="#withDocument" class="headerlink" title="withDocument"></a>withDocument</h3><p>The <code>withDocument</code> HoC displays a single document. It takes the same options as <code>withList</code>, but takes a <code>documentId</code> <strong>prop</strong>. </p>
<p>Like <code>terms</code> for <code>withList</code>, <code>documentId</code> needs to be passed not as an option, but as a prop from the <em>parent</em> component.</p>
<p>This HoC then passes on the following child prop:</p>
<ul>
<li><code>loading</code>: <code>true</code> while the data is loading.</li>
<li><code>document</code>: the loaded document.</li>
</ul>
<h3 id="Data-Updating"><a href="#Data-Updating" class="headerlink" title="Data Updating"></a>Data Updating</h3><p>As long as you use <code>withList</code> in conjunction with <code>withNew</code>, <code>withEdit</code>, and <code>withRemove</code>, your lists will automatically be updated after any mutation. This includes:</p>
<ul>
<li>Inserting new items in lists after they’re inserted.</li>
<li>Removing items when they’re removed.</li>
<li>Reordering lists when an item is edited in a way that changes a sort.</li>
<li>Removing an item after it’s been edited when it doesn’t match a list’s filters anymore. </li>
</ul>
<p>At this time, it’s only possible to benefit from this auto-updating behavior if you’re using the three built-in mutation HoCs, although making <code>withList</code> more flexible towards custom mutations is on the roadmap (PRs welcome!).</p>
<h4 id="Alternative-Approach"><a href="#Alternative-Approach" class="headerlink" title="Alternative Approach"></a>Alternative Approach</h4><p>You can replace any of Vulcan’s generic HoCs with your own tailor-made HoCs (whether it’s for queries or mutations) using the <code>graphql</code> utility. Note that if you do so, you will need to manually <a href="http://dev.apollodata.com/react/cache-updates.html" target="_blank" rel="noopener">update your queries</a> after each mutation. </p>
<h2 id="Querying-On-The-Server"><a href="#Querying-On-The-Server" class="headerlink" title="Querying On The Server"></a>Querying On The Server</h2><p>Most of this section’s contents applies to the client. After all, if you’re on the server, you can simply connect to your database directly, so why would you need to worry about the data layer?</p>
<p>But the truth is that connecting to the database directly can lead to problems. For example, let’s assume you have a <code>user</code> resolver on your <code>Post</code> type that gives you access to the post’s author. On the client, you could write:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> authorName = post.user.displayName;</span><br></pre></td></tr></table></figure>
<p>On the server, it’s easy enough to obtain that post document:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> post = Posts.findOne(documentId);</span><br></pre></td></tr></table></figure>
<p>But the document you fetch directly from MongoDB won’t have a <code>user</code> property, let alone a <code>user.displayName</code> (since those are provided by the GraphQL resolver).</p>
<p>Thankfully, VulcanJS features a few special utilities to let you query for data through GraphQL <em>on the server</em></p>
<h3 id="runQuery-query-variables"><a href="#runQuery-query-variables" class="headerlink" title="runQuery(query, variables)"></a>runQuery(query, variables)</h3><p><code>runQuery</code> lets you execute any GraphQL query against your schema and get its result back on the server. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; runQuery &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span> = (<span class="params"></span>) =&gt; </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> query = <span class="string">`</span></span><br><span class="line"><span class="string">    query OneRoom($documentId: String)&#123;</span></span><br><span class="line"><span class="string">      RoomsSingle(documentId: $documentId)&#123;</span></span><br><span class="line"><span class="string">        name</span></span><br><span class="line"><span class="string">        description</span></span><br><span class="line"><span class="string">        user&#123;</span></span><br><span class="line"><span class="string">          _id</span></span><br><span class="line"><span class="string">          displayName</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> runQuery(email.query, &#123;<span class="attr">documentId</span>: <span class="string">'123foo'</span>&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(Note that you’ll need to be inside an <code>async</code> context to use the <code>await</code> keyword)</p>
<h3 id="collection-queryOne-documentId-options"><a href="#collection-queryOne-documentId-options" class="headerlink" title="collection.queryOne(documentId, options)"></a>collection.queryOne(documentId, options)</h3><p>A common need on the server is fetching a single document by its <code>_id</code>. You can do so with <code>collection.queryOne</code>. It takes an <code>options</code> object with a <code>fragmentText</code> property. If no fragment is provided, the query will use the collection’s <code>defaultFragment</code>. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> Users.queryOne(userId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> Users.queryOne(userId, &#123;</span><br><span class="line">  fragmentText: <span class="string">`</span></span><br><span class="line"><span class="string">    fragment MyUsersFragment on User &#123;</span></span><br><span class="line"><span class="string">      _id</span></span><br><span class="line"><span class="string">      username</span></span><br><span class="line"><span class="string">      createdAt</span></span><br><span class="line"><span class="string">      posts&#123;</span></span><br><span class="line"><span class="string">        _id</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Performance-Optimization"><a href="#Performance-Optimization" class="headerlink" title="Performance Optimization"></a>Performance Optimization</h2><p>If you use complex GraphQL queries and resolvers a lot, you might notice some slow loading times. Here’s a few things you can try to speed things up.</p>
<h4 id="Add-Mongo-Indexes"><a href="#Add-Mongo-Indexes" class="headerlink" title="Add Mongo Indexes"></a>Add Mongo Indexes</h4><p>Make sure you’re adding indexes for any frequently used Mongo selectors. For example, if you’re often looking up all posts associated with a specific user ID, you’ll want to add an index for that:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Posts.rawCollection().createIndex(&#123;<span class="attr">userId</span>: <span class="number">1</span>&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Use-Dataloader"><a href="#Use-Dataloader" class="headerlink" title="Use Dataloader"></a>Use Dataloader</h4><p>Dataloader ensures your data is loaded from your server’s in-memory cache instead of the database whenever possible, leading to much faster load times. </p>
<p>You can use it whenever you’re requesting a single document or multiple documents based on their <code>_id</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// without Dataloader</span></span><br><span class="line"><span class="keyword">const</span> room = Rooms.findOne(booking.roomId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// with Dataloader</span></span><br><span class="line"><span class="keyword">const</span> room = <span class="keyword">await</span> Rooms.loader.load(booking.roomId);</span><br></pre></td></tr></table></figure>
<p>Multiple documents:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// without Dataloader</span></span><br><span class="line"><span class="keyword">const</span> photos = Photos.find(post.photoIds).fetch();</span><br><span class="line"></span><br><span class="line"><span class="comment">// with Dataloader</span></span><br><span class="line"><span class="keyword">const</span> photos = <span class="keyword">await</span> Rooms.loader.loadMany(post.photoIds);</span><br></pre></td></tr></table></figure>
<h4 id="Remove-Unnecessary-Fields"><a href="#Remove-Unnecessary-Fields" class="headerlink" title="Remove Unnecessary Fields"></a>Remove Unnecessary Fields</h4><p>Sometimes you might be asking for a field you don’t actually need, especially if you reuse the same fragments in multiple places. Always make sure you don’t load any data you don’t use, especially if these fields in turn trigger their own resolvers.</p>
<h4 id="Denormalize-Data"><a href="#Denormalize-Data" class="headerlink" title="Denormalize Data"></a>Denormalize Data</h4><p>Although GraphQL makes it possible to keep data normalized inside your database in theory, in practice it can still be better for performance to denormalize (i.e. copy) some properties. </p>
<p>For example, let’s imagine you want to know how many comments a user has made. You could definitely have a <code>commentCount</code> property with its own custom resolver that counts all comments with the right <code>userId</code>. </p>
<p>But on the other hand, it would be far better from a performance point of view to simply store that information as a field on each user document and increment/decrement it every time a user creates or delete a comment. </p>
<h4 id="Ensure-Fast-Server-DB-Speeds"><a href="#Ensure-Fast-Server-DB-Speeds" class="headerlink" title="Ensure Fast Server-DB Speeds"></a>Ensure Fast Server-DB Speeds</h4><p>At some point, the last bottleneck is the time it takes for the server to get data back from the database (assuming you’re not hosting both on the same instance). </p>
<p>For example, if you’re in Tokyo and your database is too, but your server is in New York, your data has to go from Tokyo to New York then back to Tokyo, leading to slower load times than if everything was just stored in New York.</p>
<p>For that reason, try to have both your server and database stored within the same Amazon (or equivalent) server cluster. </p>
<h4 id="Use-Caching"><a href="#Use-Caching" class="headerlink" title="Use Caching"></a>Use Caching</h4><p>Finally, services like <a href="https://www.apollographql.com/engine/" target="_blank" rel="noopener">Apollo Engine</a> make it easy to implement a global <a href="https://github.com/apollographql/engine-docs/blob/master/source/caching.md" target="_blank" rel="noopener">caching layer</a> by using <a href="https://github.com/apollographql/apollo-cache-control" target="_blank" rel="noopener">Apollo Cache Control</a>.</p>
<p>Unlike Dataloader’s cache, this is not a temporary field-by-field cache; but a persistent cache that caches the entire GraphQL response. </p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="schemas.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Collections & Schemas
        </a>
      
      
        <a class="link primary next"
          href="fragments.html">
          <span class="subtitle-pagination">Next</span>
          Fragments
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/vulcanjs/vulcan-docs/tree/master/source/data-loading.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>


    <script>
      
    </script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
      apiKey: 'ab091fbd89cda3abd54a35c4441b3e9b',
      indexName: 'vulcanjs',
      inputSelector: '#desktop-search-input',
      debug: true // Set debug to true if you want to inspect the dropdown
    });
    </script>

  </body>
</html>
